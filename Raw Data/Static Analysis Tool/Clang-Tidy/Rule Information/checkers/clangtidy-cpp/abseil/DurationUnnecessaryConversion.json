{
  "name": "DurationUnnecessaryConversion",
  "language": "cpp",
  "description": ".. title:: clang-tidy - abseil-duration-unnecessary-conversion",
  "example": null,
  "cwe": null,
  "cwe-description": null,
  "checker-language": "cpp",
  "loc": 114,
  "branches": 8,
  "apis": 95,
  "test": [
    {
      "description": null,
      "expected-problems": 37,
      "expected-linenumbers": [
        10,
        13,
        16,
        19,
        22,
        25,
        30,
        33,
        36,
        39,
        42,
        45,
        49,
        52,
        55,
        58,
        61,
        64,
        68,
        71,
        74,
        77,
        80,
        83,
        89,
        105,
        108,
        111,
        114,
        117,
        120,
        123,
        126,
        129,
        132,
        135,
        138
      ],
      "code": "\n// RUN: %check_clang_tidy --match-partial-fixes -std=c++11-or-later %s abseil-duration-unnecessary-conversion %t -- -- -I %S/Inputs\n\n#include \"absl/time/time.h\"\n\nvoid f() {\n  absl::Duration d1, d2;\n\n  // Floating point\n  d2 = absl::Hours(absl::ToDoubleHours(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Minutes(absl::ToDoubleMinutes(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Seconds(absl::ToDoubleSeconds(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Milliseconds(absl::ToDoubleMilliseconds(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Microseconds(absl::ToDoubleMicroseconds(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Nanoseconds(absl::ToDoubleNanoseconds(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n\n  // Integer point\n  d2 = absl::Hours(absl::ToInt64Hours(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Minutes(absl::ToInt64Minutes(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Seconds(absl::ToInt64Seconds(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Milliseconds(absl::ToInt64Milliseconds(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Microseconds(absl::ToInt64Microseconds(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Nanoseconds(absl::ToInt64Nanoseconds(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n\n  d2 = absl::Hours(d1 / absl::Hours(1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Minutes(d1 / absl::Minutes(1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Seconds(d1 / absl::Seconds(1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Milliseconds(d1 / absl::Milliseconds(1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Microseconds(d1 / absl::Microseconds(1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Nanoseconds(d1 / absl::Nanoseconds(1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n\n  d2 = absl::Hours(absl::FDivDuration(d1, absl::Hours(1)));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Minutes(absl::FDivDuration(d1, absl::Minutes(1)));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Seconds(absl::FDivDuration(d1, absl::Seconds(1)));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Milliseconds(absl::FDivDuration(d1, absl::Milliseconds(1)));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Microseconds(absl::FDivDuration(d1, absl::Microseconds(1)));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n  d2 = absl::Nanoseconds(absl::FDivDuration(d1, absl::Nanoseconds(1)));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1\n\n  // As macro argument\n#define PLUS_FIVE_S(x) x + absl::Seconds(5)\n  d2 = PLUS_FIVE_S(absl::Seconds(absl::ToInt64Seconds(d1)));\n  // CHECK-MESSAGES: [[@LINE-1]]:20: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: PLUS_FIVE_S(d1)\n#undef PLUS_FIVE_S\n\n  // Split by macro: should not change\n#define TOSECONDS(x) absl::Seconds(x)\n  d2 = TOSECONDS(absl::ToInt64Seconds(d1));\n#undef TOSECONDS\n\n  // Don't change something inside a macro definition\n#define VALUE(x) absl::Hours(absl::ToInt64Hours(x));\n  d2 = VALUE(d1);\n#undef VALUE\n\n  // Multiplication\n  d2 = absl::Nanoseconds(absl::ToDoubleNanoseconds(d1) * 2);\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1 * 2\n  d2 = absl::Microseconds(absl::ToInt64Microseconds(d1) * 2);\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1 * 2\n  d2 = absl::Milliseconds(absl::ToDoubleMilliseconds(d1) * 2);\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1 * 2\n  d2 = absl::Seconds(absl::ToInt64Seconds(d1) * 2);\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1 * 2\n  d2 = absl::Minutes(absl::ToDoubleMinutes(d1) * 2);\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1 * 2\n  d2 = absl::Hours(absl::ToInt64Hours(d1) * 2);\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = d1 * 2\n  d2 = absl::Nanoseconds(2 * absl::ToDoubleNanoseconds(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = 2 * d1\n  d2 = absl::Microseconds(2 * absl::ToInt64Microseconds(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = 2 * d1\n  d2 = absl::Milliseconds(2 * absl::ToDoubleMilliseconds(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = 2 * d1\n  d2 = absl::Seconds(2 * absl::ToInt64Seconds(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = 2 * d1\n  d2 = absl::Minutes(2 * absl::ToDoubleMinutes(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = 2 * d1\n  d2 = absl::Hours(2 * absl::ToInt64Hours(d1));\n  // CHECK-MESSAGES: [[@LINE-1]]:8: warning: remove unnecessary absl::Duration conversions [abseil-duration-unnecessary-conversion]\n  // CHECK-FIXES: d2 = 2 * d1\n\n  // These should not match\n  d2 = absl::Seconds(absl::ToDoubleMilliseconds(d1));\n  d2 = absl::Seconds(4);\n  int i = absl::ToInt64Milliseconds(d1);\n  d2 = absl::Hours(d1 / absl::Minutes(1));\n  d2 = absl::Seconds(d1 / absl::Seconds(30));\n  d2 = absl::Hours(absl::FDivDuration(d1, absl::Minutes(1)));\n  d2 = absl::Milliseconds(absl::FDivDuration(d1, absl::Milliseconds(20)));\n  d2 = absl::Seconds(absl::ToInt64Milliseconds(d1) * 2);\n  d2 = absl::Milliseconds(absl::ToDoubleSeconds(d1) * 2);\n}"
    }
  ]
}